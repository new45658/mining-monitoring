#### 单机版流程梳理
* 执行shell命令，得到 shell的输出结果
* 解析指定数据格式
* 把第一次解析的的信息存储起来(如果有连接客户端推送到前端 ?)
* 每次上报的信息与存在的记录进行比对，把新的变化的数据推送到前端，并把变化的更新到 map中
    * 遍历长度大的map
    * 取新的map key value；与旧map比对，key存在，判断value值；把 key 不存在，value不同的值，存到新map
    * 把变化的数据集 map 推送到前端
* (数据信息定时更新)  


    

#### 代码结构
主要模块

* shellParsing  shell解析模块
* websocket 服务模块
    * server 管理client,推送等服务
    * client (汇总如果需要)
* dataProcessing  数据处理,比价数据变化等操作
* cmd  协议定义
* other    


#### 数据格式定义

miner信息
 
    minerId:string                    // minerId
    MinerBalance:string               // miner余额
    postBalance:string                // post余额 
    workerBalance:string              // worker余额
    pldegeBalance:string              // 抵押
    totalMessages:int                 // 消息总数
    rawBytePower:int                  // 字节算力
    adjustedPower:int                 // 原值算力
    effectivePower:int                // 有效算力
    totalSectors:int                  // 总扇区数
    effectiveSectors:int              // 有效扇区
    errorSectors:int                  // 错误扇区
    recoverySectors:int               // 恢复中扇区
    deletedSectors:int                // 删除扇区
    failSectors:int                   // 失败扇区
    workerInfo:[                      // worker信息 
        {
            hostname:string           
            currentQueue:{
                pc1:[
                     {
                          type:string    //任务类型
                          sectorId:string//扇区Id
                          tatus:int     // 任务状态
                          spendTime:int  // 耗时
                      }
                    ]
                 pc2:[
                     {
                          type:string    //任务类型
                          sectorId:string//扇区Id
                          tatus:int     // 任务状态
                          spendTime:int  // 耗时
                      }                    
                 ]
                 ...   
            }
            pendingQueue:[           // 队列中任务
                pc1:[
                     {
                          type:string    //任务类型
                          sectorId:string//扇区Id
                          tatus:int     // 任务状态
                          spendTime:int  // 耗时
                      }
                    ]
                 pc2:[
                     {
                          type:string    //任务类型
                          sectorId:string//扇区Id
                          tatus:int     // 任务状态
                          spendTime:int  // 耗时
                      }                    
                 ]
                 ...  
            ]
            cpuTemper:float         // cpu问题
            cpuLoad:float           // cupu负载
            gpuTemper:float         // gpu温度
            gpuLoad:float           // gpu负载
            memory:string           // 内存信息
            useDisk:float           // 磁盘使用率
            diskRW:string           //磁盘IO
            netRW:string            //网络IO
            
        }
    ]
    timestamp:                      // 此次统计时间
            

    
#### 接口定义

通用发送命令结构

    {
        "uri": string,   // 命令类型
        "body": object,  // 参数
        "msgId": string  //msgid 随机字符串
    }
    
通用返回响应

    {
        "code": int ,        // 1,成功,0失败
        "message":String,    // 提示消息
        "msgId": string      // cmdId
        "data":Object        // 返回结果
    }    
    



#### 订阅事件

订阅事件命令

    {
            "event":string,  //订阅命令
            "msgId":string,
            "body":Object
    }


订阅的消息实时返回结构体

    {
            "code":string,
            "message":string,
            "body":Object
    }




#### 获取总体信息
返回miner相关信息


    request
        uri: minerInfo
        body:{
            minerId:string //string 矿工Id
        } 
    
    response
        {
            minerId:string
            MinerBalance:string
            postBalance:string
            workerBalance:string
            pldegeBalance:string
            totalMessages:int
            rawBytePower:int
            adjustedPower:int
            effectivePower:int
            totalSectors:int
            effectiveSectors:int
            errorSectors:int
            recoverySectors:int
            deletedSectors:int
            failSectors:int
            workerInfo:[
                {
                    hostname:string
                    currentQueue:[
                            pc1:[
                                 {
                                      type:string    //任务类型
                                      sectorId:string//扇区Id
                                      tatus:int     // 任务状态
                                      spendTime:int  // 耗时
                                  }
                                ]
                             pc2:[
                                 {
                                      type:string    //任务类型
                                      sectorId:string//扇区Id
                                      tatus:int     // 任务状态
                                      spendTime:int  // 耗时
                                  }                    
                             ]
                             ...  
                    ]
                    pendingQueue:[
                            pc1:[
                                 {
                                      type:string    //任务类型
                                      sectorId:string//扇区Id
                                      tatus:int     // 任务状态
                                      spendTime:int  // 耗时
                                  }
                                ]
                             pc2:[
                                 {
                                      type:string    //任务类型
                                      sectorId:string//扇区Id
                                      tatus:int     // 任务状态
                                      spendTime:int  // 耗时
                                  }                    
                             ]
                             ...  
                    ]
                    cpuTemper:float
                    cpuLoad:float
                    gpuTemper:float
                    gpuLoad:float
                    memory:string
                    useDisk:float
                    diskRW:string
                    ioUpDown:string
                    
                }
            ]
            timestamp:int
        }    
    
    
 
        
#### 订阅miner信息
该接口只把变化的数据推送到前端，前端根据需求自行更新

    request
    
        {
                "event":subMinerInfo,  //订阅命令
                "body":{minerId:t0000}
        }
            
    response
        {
            minerId:string
            MinerBalance:string
            postBalance:string
            workerBalance:string
            pldegeBalance:string
            totalMessages:int
            rawBytePower:int
            adjustedPower:int
            effectivePower:int
            totalSectors:int
            effectiveSectors:int
            errorSectors:int
            recoverySectors:int
            deletedSectors:int
            failSectors:int
            workerInfo:[
                {
                    hostname:string
                    currentQueue:[
                            pc1:[
                                 {
                                      type:string    //任务类型
                                      sectorId:string//扇区Id
                                      tatus:int     // 任务状态
                                      spendTime:int  // 耗时
                                  }
                                ]
                             pc2:[
                                 {
                                      type:string    //任务类型
                                      sectorId:string//扇区Id
                                      tatus:int     // 任务状态
                                      spendTime:int  // 耗时
                                  }                    
                             ]
                             ...  
                    ]
                    pendingQueue:[
                            pc1:[
                                 {
                                      type:string    //任务类型
                                      sectorId:string//扇区Id
                                      tatus:int     // 任务状态
                                      spendTime:int  // 耗时
                                  }
                                ]
                             pc2:[
                                 {
                                      type:string    //任务类型
                                      sectorId:string//扇区Id
                                      tatus:int     // 任务状态
                                      spendTime:int  // 耗时
                                  }                    
                             ]
                             ...  
                    ]
                    cpuTemper:float
                    cpuLoad:float
                    gpuTemper:float
                    gpuLoad:float
                    memory:string
                    useDisk:float
                    diskRW:string
                    ioUpDown:string
                    
                }
            ]
            timestamp:int
        }
        
        

    



    
    







