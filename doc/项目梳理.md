#### 单机版流程梳理
* 执行shell命令，得到 shell的输出结果
* 解析指定数据格式(如果是服务器版，解析完成 websocket上报即可)
* 把第一次解析的的信息存储起来(如果有连接客户端推送到前端 ?)
* 每次上报的信息与存在的记录进行比对，把新的变化的数据推送到前端，并把变化的更新到 map中
    * 遍历长度大的map
    * 取新的map key value；与旧map比对，key存在，判断value值；把 key 不存在，value不同的值，存到新map
    * 把变化的数据集 map 推送到前端
* (数据信息定时更新)  

tips:
> (客户端连接服务端成功后，直接推送？客户端方便处理? 改成订阅模式)

    

#### 代码结构
主要模块

* shellParsing  shell解析模块
* websocket 服务模块
    * server 管理client,推送等服务
    * client (汇总如果需要)
* dataProcessing  数据处理,比价数据变化等操作
* cmd  协议定义
* other    


#### 数据格式定义

miner信息
 
    minerId:string
    MinerBalance:{    
          PreCommit: string 
          Pledge: string    
          Vesting: string  
          Available:string
         }  
    MarketBalance:   
           Locked: string 
           Available:string
    WorkerBalance: string  
    TotalSpendable:string  
    Sectors:{
        Total: int
        Proving: int
        PreCommit1: int
        WaitSeed: int
        Committing: int
    }
    timestamp:int
    ...
            
worker信息
    
    minerId: string 
    hostName:string
    currentQueue:[
       type:string
       sectorId:string
       status:int
       spendTime:int
    ]
    pendingQueue:[
         // 与 taskQueue类似
    ]
    hardwardInfo:{
        cpuTemperature:float
        cpuUse:float
        ...
    }
    timestamp:int
    
    ....
    
#### 接口定义

通用发送命令结构

    {
        "uri": string,   // 命令类型
        "body": object,  // 参数
        "msgId": string  //msgid 随机字符串
    }
    
通用返回响应

    {
        "code": int ,        // 1,成功,0失败
        "message":String,    // 提示消息
        "msgId": string      // cmdId
        "data":Object        // 返回结果
    }    
    



#### 订阅事件

订阅事件命令

    {
            "event":string,  //订阅命令
            "msgId":string,
            "body":Object
    }


订阅的消息实时返回结构体

    {
            "code":string,
            "message":string,
            "body":Object
    }


tips
> 单机版minerInfo和workerInfo可以合并，便与后期服务器版,拆分好点？


#### 获取总体信息
    request
        uri: minerInfo
        body:{
            minerId:string //string 矿工Id
        } 
    
    response
    
        {
            minerInfo:{
                "minerId":"",
                 "minerBalance":{    
                     "preCommit": "", 
                     "pledge": "",    
                      vesting": "",  
                      "available":"", 
                      }  
                 MarketBalance:{
                                
                 }
            }
        }
    
    
    
#### Worker信息

    request
    
        uri: workerInfo
        body:{
            minerId:string   //string 矿工Id
        } 
    
    response
    
        [
            {
                "hostname":"yan_an01" // 主机名称
                "taskQueue":[
                        "type": "p1",       // 任务类型
                        "sectorId":100,     // 扇区Id
                        "spendTime":100,    // 任务时间
                        "status":1 ,      // 任务状态
                        
                 ] // 当前任务队列
                "pendingQueue":[
                         "type": "p1",       // 任务类型
                          "sectorId":100,     // 扇区Id
                          "spendTime":100,    // 任务时间
                          "status":1 ,      // 任务状态
                 ] // 任务队列中,
                 "hadrwardInfo":{
                           "cpuTemperature":100,
                           "cpuUse":100
                           ...
                  }   
            }
        ]   
        
        
#### 订阅miner信息
    request
    
        {
                "event":subMinerInfo,  //订阅命令
                "body":{minerId:t0000}
        }
            
    response
        {
                minerInfo:{
                    "minerId":"",
                     "minerBalance":{    
                         "preCommit": "", 
                         "pledge": "",    
                          vesting": "",  
                          "available":"", 
                          }  
                     MarketBalance:{
                                    
                               }
                }
        }
        
        
        
#### 订阅 worker信息

    request
    
        {
                "event":subWorkerInfo,  //订阅命令
                "body":{minerId:t00000}
        }
            
    response
    
        [
            {
                "hostname":"yan_an01" // 主机名称
                "taskQueue":[
                        "type": "p1",       // 任务类型
                        "sectorId":100,     // 扇区Id
                        "spendTime":100,    // 任务时间
                        "status":1 ,      // 任务状态
                        
                 ] // 当前任务队列
                "pendingQueue":[
                         "type": "p1",       // 任务类型
                          "sectorId":100,     // 扇区Id
                          "spendTime":100,    // 任务时间
                          "status":1 ,      // 任务状态
                 ] // 任务队列中,
                 "hadrwardInfo":{
                           "cpuTemperature":100,
                           "cpuUse":100
                           ...
                  }   
            }
        ] 
                    
    
    
    

    
    
    
        
    
     
    
    



    
    







